#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir> <env-dir>

set -eo pipefail

VENDOR_DIR="/app/.heroku/vendor"

echo "-----> Installing binaries..."

# Install fortran libraries
if [ -d "$VENDOR_DIR" ]; then
  echo "-----> Using cached binaries..."
else
  echo "-----> Installing AWS Client...."
  curl -O "https://s3.amazonaws.com/aws-cli/awscli-bundle.zip"
  mkdir -p $VENDOR_DIR
  unzip awscli-bundle.zip
  rm -f awscli-bundle.zip
  $(pwd)/awscli-bundle/install -i $VENDOR_DIR -b $VENDOR_DIR/aws -i $VENDOR_DIR/bin/aws

  echo "-----> Installing Heroku Client...."
  curl -s https://s3.amazonaws.com/assets.heroku.com/heroku-client/heroku-client.tgz | tar xz
  mv heroku-client $VENDOR_DIR/bin/heroku-client
  ln -s /app/.heroku/vendor/bin/heroku-client/bin/heroku /app/.heroku/vendor/heroku

  echo "-----> Installing go...."
  curl -s https://storage.googleapis.com/golang/go1.7.3.linux-amd64.tar.gz | tar xz
  mv go $VENDOR_DIR/bin/go
  ln -s /app/.heroku/vendor/bin/go/bin/go /app/.heroku/vendor/go
fi

echo "-----> I'm done, buddy."
